@model List<SubWallet.Models.Subscription>
@{
    ViewData["Title"] = "Subscriptions";
}

<h1>Subscriptions</h1>

<form asp-action="Add" asp-controller="Subscriptions" method="post">
    <label for="Name">Name:</label>
    <input type="text" id="Name" name="Name" required />

    <label for="Cost">Cost:</label>
    <input type="number" id="Cost" name="Cost" step="0.01" required />

    <label for="StartDate">Start Date:</label>
    <input type="date" id="StartDate" name="StartDate" required />

    <label for="Cycle">Billing Cycle:</label>
    <select id="Cycle" name="Cycle">
        <option value="Weekly">Weekly</option>
        <option value="BiWeekly">BiWeekly</option>
        <option value="Monthly">Monthly</option>
        <option value="Yearly">Yearly</option>
    </select>

    <button type="submit">Add Subscription</button>
</form>

<hr />

<!-- Chart + Actions side by side -->
<div style="display:flex; gap:30px; align-items:flex-start; margin-top:20px;">
    <!-- Chart -->
    <div style="flex:2;">
        <canvas id="subscriptionsChart" style="max-width:600px; height:300px;"></canvas>
    </div>

    <!-- Actions (Delete + Edit) -->
    <div style="flex:1;">
        <!-- Delete -->
        <h2>Delete Subscription</h2>
        <form asp-action="Delete" asp-controller="Subscriptions" method="post">
            <label for="deleteSelect">Select:</label>
            <select id="deleteSelect" name="Name">
                @foreach (var sub in Model)
                {
                    <option value="@sub.Name">@sub.Name</option>
                }
            </select>
            <button type="submit">Delete</button>
        </form>

        <hr />

        <!-- Edit -->
        <h2>Edit Subscription</h2>
        <form asp-action="Edit" asp-controller="Subscriptions" method="post">
            <label for="editSelect">Select:</label>
            <select id="editSelect" name="Name">
                @foreach (var sub in Model)
                {
                    <option value="@sub.Name">@sub.Name</option>
                }
            </select>

            <label for="NewCost">New Cost:</label>
            <input type="number" id="NewCost" name="Cost" step="0.01" required />

            <label for="NewCycle">New Cycle:</label>
            <select id="NewCycle" name="Cycle">
                <option value="Weekly">Weekly</option>
                <option value="BiWeekly">BiWeekly</option>
                <option value="Monthly">Monthly</option>
                <option value="Yearly">Yearly</option>
            </select>

            <button type="submit">Update</button>
        </form>
    </div>
</div>

<!-- Chart.js Script -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
    const ctx = document.getElementById('subscriptionsChart').getContext('2d');

    const labels = @Html.Raw(Newtonsoft.Json.JsonConvert.SerializeObject(Model.Select(s => s.Name)));
    const data = @Html.Raw(Newtonsoft.Json.JsonConvert.SerializeObject(Model.Select(s => s.Cost)));

    new Chart(ctx, {
        type: 'bar',
        data: {
            labels: labels,
            datasets: [{
                label: 'Monthly Cost (U.S Dollars)',
                data: data,
                borderWidth: 1,
                backgroundColor: ['#FF6384', '#36A2EB', '#FFCE56', '#4BC0C0', '#9966FF']
            }]
        },
        options: {
            responsive: true,
            plugins: {
                legend: { position: 'top' }
            }
        }
    });
</script>
